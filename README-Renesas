
 Renesas EMMA EV2 bootloader

If you want to known more about the boot sequence for this platform, you can refer the following document:

R19UH0036EJ0600_1chip.pdf

 -> Appendix C: Boot loader in ROM 

 - - - - 

This u-boot can be compiled with different configurations, for the Renesas EMMA platforms:

 emev_emmc_config
 emev_sd_config
 emev_sd_line_config

EM/EV ROM boot code exist in 0xFFFF_0000, and it use internal SRAM 0xF000_0000. This ROM boot code will load mini-boot to SRAM and jump to 0xF000_0000. For SD boot mode, miniboot is sdboot.bin in the SD card root directory. For eMMC boot, miniboot is the first 8K bytes in mmcblk0p1. Miniboot will load the remaining part.

SD boot:
Load rest of u-boot (uboot-sd.bin to DDR#0x4100_8000)
Load kernel image (uImage to DDR#0x4000_7fc0)
Load ram disk (cramfs to DDR#0x4600_0000), this is optional due to compile option

eMMC boot:
Load rest of u-boot (mmcblk0p1#0x0000_2000-0x0004_0000 to DDR#0x4100_8000)
Load kernel image (mmcblk0p2 to DDR#0x4000_7fc0)
Then jump to u-boot

There will be different boot arguments from u-boot, the definition of which can be found in the u-boot code, in include/configs/emev.h:

Code:

...
#define CONFIG_CRAMFSCMD	"setenv bootargs root=/dev/null noinitrd init=/linuxrc console=ttyS0,115200n8n SELINUX_INIT=no \$(cfg_ddr) ro video=qfb: ip=none rootflags=physaddr=0x00500000\;bootm 00080000"
#ifdef CONFIG_EMXX_SDBOOT_LINE	/* SD boot linesystem */
#define CONFIG_EXT3CMD		"setenv bootargs root=/dev/null noinitrd init=/linuxrc console=ttyS0,115200n8n SELINUX_INIT=no mem=96M@0x40000000 rw video=qfb: ip=none rootflags=physaddr=0x46000000\;bootm 40007fc0"
#else
#define CONFIG_EXT3CMD		"setenv bootargs root=\$(ext3_root) noinitrd init=/linuxrc console=ttyS0,115200n8n SELINUX_INIT=no \$(cfg_ddr) rw video=qfb: ip=none rootfstype=ext3 rootwait\;bootm 40007fc0"
#endif
...

If you mount mount cramfs to your file system, out of a typical firmware update package (which includes both a "cramfs4" file and an "install.sh" script), you can see how the install script is invoked:

Code:

sudo mkdir /mnt/cramfs
sudo mount -o loop cramfs4 /mnt/cramfs
ls -l /mnt/cramfs/linuxrc
lrwxrwxrwx 1 root root 11 1970-01-01 01:00 /mnt/cramfs/linuxrc -> bin/busybox
cd /mnt/cramfs/etc/init.d/
cat rcS
...
    INSTALL_SH=`ls /tmp/sd/install.sh`
    if [ "$INSTALL_SH" = "/tmp/sd/install.sh" ]; then
        /tmp/sd/install.sh
    fi
...

Note how the boot command inlcudes "init=/linuxrc", which points to a standard busybox executable. This will by default invoke the "::sysinit:/etc/init.d/rcS" action.

 - - - -

Examples

> export CROSS_COMPILE=arm-linux-androideabi-
> cd u-boot

1) for eMMC boot

> make distclean
> make emev_emmc_config
> make

Got these files:

...
-rwxr-xr-x    1 root root  390296 Feb  2 05:47 u-boot.srec
-rw-r--r--    1 root root  114797 Feb  2 05:47 u-boot.map
-rwxr-xr-x    1 root root  130068 Feb  2 05:47 u-boot.bin
-rwxr-xr-x    1 root root  453562 Feb  2 05:47 u-boot
-rw-r--r--    1 root root   19488 Feb  2 05:47 System.map
-rw-r--r--    1 root root  138260 Feb  2 05:47 u-boot-emmc.bin

2) for SD "line" boot (i.e. including the 'cramfs' File System)

> make distclean
> make emev_sd_line_config
> make
...

-rwxr-xr-x    1 root root  389442 Feb  2 06:08 u-boot.srec
-rw-r--r--    1 root root  129784 Feb  2 06:08 uboot-sd.bin
-rw-r--r--    1 root root  114675 Feb  2 06:08 u-boot.map
-rwxr-xr-x    1 root root  129784 Feb  2 06:08 u-boot.bin
-rwxr-xr-x    1 root root  447246 Feb  2 06:08 u-boot
-rw-r--r--    1 root root   19523 Feb  2 06:08 System.map
-rwxr-xr-x    1 root root    8312 Feb  2 06:08 sdboot.bin

3) for SD boot

> make distclean
> make emev_sd_config
> make
...

-rw-rw-r--   1 ffxx68 ffxx68  107440 2012-02-23 06:51 u-boot.map
-rwxrwxr-x   1 ffxx68 ffxx68  518590 2012-02-23 06:51 u-boot
-rwxrwxr-x   1 ffxx68 ffxx68  368258 2012-02-23 06:51 u-boot.srec
-rwxrwxr-x   1 ffxx68 ffxx68  122728 2012-02-23 06:51 u-boot.bin
-rw-rw-r--   1 ffxx68 ffxx68   19173 2012-02-23 06:51 System.map
-rw-rw-r--   1 ffxx68 ffxx68  122728 2012-02-23 06:51 uboot-sd.bin
-rwxrwxr-x   1 ffxx68 ffxx68    8192 2012-02-23 06:51 sdboot.bin
